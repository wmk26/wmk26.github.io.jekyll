---
layout: post
title: c++中的define和const和常量
date: 2016-08-01
categories: c++
tags: c++
---

在c++中，define和const都可以定义常量，一般情况下，推荐用const代替define。两者的区别如下：

## 1. 比较

异同 | define | const
---|---|---
编译器处理方式 | 在预处理阶段进行替换； | 在编译时确定其值；
类型检查 | 无类型，不进行类型安全检查，可能会产生意想不到的错误（边际效应）； | 有数据类型，编译时会进行类型检查；
内存空间 | 不分配内存，给出的是立即数，有多少次使用就进行多少次替换，在内存中会有多个拷贝，消耗内存大； |  在静态存储区中分配空间，在程序运行过程中内存中只有一个拷贝；
效率 | 只作替换，不做计算，不做表达式求解；| 在编译时， 编译器通常不为const常量分配存储空间，而是将它们保存在符号表中，这使得它成为一个编译期间的常量，没有了存储与读内存的操作，使得它的效率也很高；（const定义常量从汇编的角度来看，只是给出了对应的内存地址）
指针 | 不可以用指针变量去指向； | 可以用指针去指向该常量的地址； 
函数 | 可以定义一些简单的函数； | 不可以定义函数；

## 2. 总结

define定义的常量是无类型的，在预处理阶段中直接拷贝替换，会有多个拷贝，因此会消耗内存；const定义的常量是有类型的，在编译时确定其值，只有一份拷贝，编译器通常不会为const常量分配存储空间，而是将它保存在符号表中，效率较高；

## 3. 一般规则

- 在C++ 程序中只使用const常量而不使用宏常量，即const常量完全取代宏常量。
- 需要对外公开的常量放在头文件中，不需要对外公开的常量放在定义文件的头部。为便于管理，可以把不同模块的常量集中存放在一个公共的头文件中。

## 4. 类常量

创建在整个类中都恒定的常量通常有如下两种方法，直接定义const不可行，因为不同对象的const数据成员的值不同：

- 使用enum；
- 使用static const；

## 5. 字符串常量

字符串常量应该在头文件中声明，而在源文件中定义并初始化。原因如下：

- 如果在头文件中定义并初始化，那么包含了该头文件的每一个编译单元都会为字符串常量创建拷贝，比较消耗内存；
- 如果在头文件中声明，在源文件中定义并初始化，那么每一个包含该头文件的编译单元访问的不仅是常量指针常量的唯一实体，而且字符串常量也是唯一的实体。这样可以节约内存。

## 6. 参考资料

- 《高质量C/C++编程指南》第五章
- [const常量与define宏定义的区别](http://blog.csdn.net/love_gaohz/article/details/7567856)
- [C++中define与const的区别](http://blog.csdn.net/yingyujianmo/article/details/51206460)



















